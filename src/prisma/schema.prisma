generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

generator erd {
  provider = "prisma-erd-generator"
  output   = "../generated/ERD.png"
  format   = "png"
  theme    = "dark"
}

datasource db {
  provider = "postgresql"
}

model Usuario {
  email           String       @id
  nombre          String
  passwordHash    String
  SEP             Int          @default(0)
  ELO             Int          @default(500)
  partidasJugadas Int          @default(0)
  victorias       Int          @default(0)
  derrotas        Int          @default(0)
  fechaCreacion   DateTime     @default(now())
  cartasJugadas   Int          @default(0)
  barajas         Baraja[]     @relation("crea")
  partidasGanadas Partida[]    @relation("partidaGanador")
  Usuario_A       Usuario[]    @relation("Amigos")
  Usuario_B       Usuario[]    @relation("Amigos")
  cartas          Carta[]      @relation("CartasUsuario")
  cosmeticos      Cosmeticos[] @relation("CosmeticosObtenidos")
  logros          Logros[]     @relation("LogrosConseguidos")
  partidas        Partida[]    @relation("partidaJugadores")
}

model Carta {
  nombre      String        @id
  tipo        Tipo_Carta
  calidad     Rareza
  descripcion String
  barajas     BarajaCarta[]
  logros      Logros?       @relation("RecompensaJugable")
  Efectos     Efecto[]      @relation("CartaEfectos")
  usuarios    Usuario[]     @relation("CartasUsuario")
}

model Efecto {
  nombre      String        @id
  descripcion String
  Afecta      Tipo_Afeccion
  tipo        Tipo_Efecto
  cartas      Carta[]       @relation("CartaEfectos")
}

model Logros {
  nombre      String     @id
  descripcion String
  requisito   Int
  tipo        Tipo_Logro
  cartaID     String?    @unique
  carta       Carta?     @relation("RecompensaJugable", fields: [cartaID], references: [nombre])
  usuarios    Usuario[]  @relation("LogrosConseguidos")
}

model Partida {
  ID                   String          @id @default(uuid())
  Estado               Estado
  SnapshotJugadores    Json
  FechaInicio          DateTime        @default(now())
  FechaFin             DateTime?
  Configuracion        Json
  SnapshotTablero      Json
  tableroInicialNombre String?
  ganadorEmail         String?
  barajas              BarajaPartida[]
  ganador              Usuario?        @relation("partidaGanador", fields: [ganadorEmail], references: [email])
  tableroInicial       TableroInicial? @relation("inicio", fields: [tableroInicialNombre], references: [Nombre])
  partidaJugadores     Usuario[]       @relation("partidaJugadores")
}

model TableroInicial {
  Nombre                 String    @id
  SnapshotTableroInicial Json
  partidas               Partida[] @relation("inicio")
}

model Baraja {
  Nombre       String          @unique
  usuarioEmail String
  Usuario      Usuario         @relation("crea", fields: [usuarioEmail], references: [email])
  BarajaCartas BarajaCarta[]
  UsadaEn      BarajaPartida[]

  @@id([Nombre, usuarioEmail])
}

model BarajaCarta {
  barajaNombre       String
  barajaUsuarioEmail String
  cartaNombre        String
  baraja             Baraja @relation(fields: [barajaNombre, barajaUsuarioEmail], references: [Nombre, usuarioEmail])
  carta              Carta  @relation(fields: [cartaNombre], references: [nombre])

  @@id([barajaNombre, barajaUsuarioEmail, cartaNombre])
}

model BarajaPartida {
  barajaNombre       String
  barajaUsuarioEmail String
  partidaID          String
  baraja             Baraja  @relation(fields: [barajaNombre, barajaUsuarioEmail], references: [Nombre, usuarioEmail])
  partida            Partida @relation(fields: [partidaID], references: [ID])

  @@id([barajaNombre, barajaUsuarioEmail, partidaID])
}

model Cosmeticos {
  nombre      String         @id
  tipo        Tipo_Cosmetico
  descripcion String
  usuarios    Usuario[]      @relation("CosmeticosObtenidos")
}

enum Tipo_Carta {
  Ofensiva
  Defensiva
  Apoyo
}

enum Rareza {
  Comun
  Rara
  Epica
  Legendaria
}

enum Tipo_Afeccion {
  Jugador
  Casilla
}

enum Tipo_Efecto {
  Dados
  Cartas
  Bufo
  Debufo
  Movimiento
}

enum Tipo_Logro {
  SEP
  ELO
  Partidas
  Victorias
  Derrotas
  CartasJugadas
  CartasColeccionadas
  LogrosDesbloqueados
}

enum Estado {
  EnEspera
  EnCurso
  Finalizada
}

enum Tipo_Cosmetico {
  Icono
  Skin_Ficha
  Skin_Serpiente
  Skin_Escalera
}
